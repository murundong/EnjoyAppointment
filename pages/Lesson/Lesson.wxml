<wxs module="LessonWxs" src="../../WXS/UtilWxs.wxs" />
<view class="content-root">
  <l-sticky scrollTop="{{scrollTop}}">
    <l-sticky-item top="0">
      <view slot="body">
        <swiper wx:if="{{banners}}" class="swipper" indicator-dots="true" autoplay="true" interval="3000">
          <block wx:for="{{banners}}" wx:key="id">
            <swiper-item>
              <image src="{{baseImgURL+item}}" bindtap="onPreviewImg" data-src="{{baseImgURL+item}}">
              </image>
            </swiper-item>
          </block>
        </swiper>
        <view class="banner-content">
          <view class="banner-content-title">
            <view class="banner-title-name">{{doorName}}</view>
            <view class="banner-title-desc">
              <text>简介:</text>
              <text>{{doorDesc==null?'':doorDesc}}</text>
            </view>
          </view>
          <view class="banner-content-body">
            <view class="banner-content-manager">
              <image src="{{doorManagerImg}}"></image>
              <view class="banner-manager-detail">
                <view class="banner-content-form">
                  <text>馆主:</text>
                  <text class="banner-form-right">{{doorMananger}}</text>
                </view>
                <view class="banner-content-form">
                  <l-icon name='phone' size="26" color="#525562" />
                  <text class="banner-form-right">{{doorTel==null?'':doorTel}}</text>
                </view>
                <view class="banner-content-form">
                  <l-icon name='address' size="26" color="#525562" />
                  <text class="banner-form-right">{{doorAddress==null?'':doorAddress}}</text>
                </view>
              </view>

            </view>
          </view>
          <l-notice-bar l-class="notice-bar" speed="2000" front-icon-name="notification" close="true" type="roll"
            show="{{true}}">
            {{NewMessage}}
          </l-notice-bar>
          <view class="r-line"></view>
        </view>
      </view>
    </l-sticky-item>
    <l-sticky-item top="0" l-header-class="l-sticky-head">
      <view slot="header">
        <view class="choose-date">
          <view class="choose-date-title">
            <text class="date-title-icon"></text>
            <text class="date-title-text">周课表</text>
          </view>
          <view class="choose-date-cal">
            <l-icon class="choose-date-icon" size="28" color="#525562" name="history" />
            <picker mode="date" value="{{startDay}}" bindchange="onDateChange">
              <view>{{startDay}}</view>
            </picker>

          </view>
        </view>
        <r-calender id="r-cal" StartDay="{{startDay}}" class="sticky-cal" bind:onItemTap="onCanlenderItemTap">
        </r-calender>
        <view class="r-line-dash"></view>
        <r-class wx:if="{{classes_type.length>0}}" id="comp-class" datalist="{{classes_type}}" bind:onItemTap="onTopbarItemTap"></r-class>
        <view class="r-line"></view>
      </view>

      <view slot="body" class="content">
        <l-status-show l-class="status-show" show="{{_noData}}" type="data" full-screen="{{false}}"
      describe="所选日期暂时还没有排课哦~" />
        <block wx:for="{{classes}}" wx:key="index">
          <view class="class-card">
            <view class="class-card-img">
              <image src="{{baseImgURL+item.Subject.subject_img}}"></image>
            </view>
            <view class="class-card-content" data-obj="{{item}}" bindtap="onShowItemDetail">
              <view class="class-card-title" >
                <text class="card-status" wx:if="{{item.AppointStatus==-2}}">满员</text>
                <text class="card-title">{{item.Subject.subject_name}}</text>
              </view>

              <view class="class-card-tag">
                <block wx:for="{{item.Subject.lst_subject_tag}}" wx:for-item="itags" wx:key="index">
                  <text>{{itags}}</text>
                </block>
              </view>
              <view class="class-card-time">
                <text class="card-time-teacher">{{item.Subject.subject_teacher}}</text>
                <text class="card-time-time">{{LessonWxs.GenerateDuration(item.course_time,item.Subject.subject_duration) }}</text>
              </view>
              <view class="class-card-status">
                <view class="class-card-status-border">
                  <text class="status-num">{{item.AppointUsers.length}}人/{{item.max_allow}}人</text>
                  <text class="status-less">(最低{{item.min_allow}}人)</text>
                </view>
                <view>
                  <text class="already-appoint" wx:if="{{item.AppointStatus==2}}">已预约</text>
                </view>

              </view>
              <view catchtap="onOrderTap" class="card-order-btn" data-cid="{{item.id}}" wx:if="{{item.AppointStatus==1}}">
                预约
              </view>
              <view catchtap="onFullTap" class="card-order-unbtn" 
              data-cid="{{item.id}}" wx:elif="{{item.AppointStatus==2}}">取消</view>
              <view catchtap="onQueueTap" class="card-queue-unbtn" data-cid="{{item.id}}" wx:elif="{{item.AppointStatus==3}}">排队</view>
            </view>
          </view>
        </block>
      </view>
    </l-sticky-item>
  </l-sticky>
  <l-arc-popup show="{{_showModel}}" max-height="900">
    <view class="arcpop-content">
     <view class="arcpop-header" slot="header">
      <image src="{{baseImgURL+_showModelData.Subject.subject_img}}" />
      <view>{{_showModelData.Subject.subject_name}}</view>
     </view>
     <view class="arcpop-body">
      <view class="arcpop-body-line">
        <view>
          <l-icon name="time" color="#525562" size="22"/>
          <text>取消时限</text>
        </view>
        <view>{{_showModelData.cancel_duration}} 分钟</view>
      </view>
      <view class="arcpop-body-line">
        <view>
          <l-icon name="picture" color="#525562" size="22"/>
          <text>可用会员卡</text>
        </view>
        <!-- <view class="class-card-tag">
                <block wx:for="{{_showModelData.Subject.lst_subject_tag}}" wx:for-item="itags" wx:key="index">
                  <text>{{itags}}</text>
                </block>
        </view> -->
      </view> 
      <view class="r-line"></view>
      <view class="arcpop-body-line">
        <view>
          <l-icon name="comment" color="#525562" size="22"/>
          <text>课程备注</text>
        </view>
        <view>{{_showModelData.course_desc}}</view>
      </view>
      <view class="r-line"></view>
      <view class="arcpop-body-line">
        <view>
          <l-icon name="user" color="#525562" size="22"/>
          <text>预约名单</text>
        </view>
        <view>
          <block wx:for="{{_showModelData.AppointUsers}}" wx:key="index">
            <view class="arcpop-user-line">
              <image src="{{item.avatar}}"/>
              <view>{{item.door_remark!=null  &&item.door_remark!='' ? item.door_remark:item.nick_name }}</view>
            </view>
            <view>第{{index}}名</view>
          </block>
        </view>
      </view>

     </view>
    </view>
  </l-arc-popup>
</view>